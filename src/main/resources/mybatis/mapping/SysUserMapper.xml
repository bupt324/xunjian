<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SysUserMapper">
    <!-- 用户列表(用户组) -->
    <select id="userlistPage" parameterType="page" resultType="pd" useCache="false">
        select  u.USER_ID,
        u.USERNAME,
        u.PASSWORD,
        u.LAST_LOGIN,
        u.NAME,
        u.IP,
        u.EMAIL,
        u.NUMBER,
        u.PHONE,
        u.workshop,
        r.ROLE_ID,
        r.ROLE_NAME
        from SYS_USER u, SYS_ROLE r
        where u.ROLE_ID = r.ROLE_ID
        and u.USERNAME != 'admin'
        and (r.ROLE_ID != '7' and r.PARENT_ID != '7')
        <if test="pd.USERNAME != null and pd.USERNAME != ''"><!-- 关键词检索 -->
            and
            (
            u.USERNAME LIKE CONCAT(CONCAT('%', #{pd.USERNAME}),'%')
            or
            u.EMAIL LIKE CONCAT(CONCAT('%', #{pd.USERNAME}),'%')
            or
            u.NUMBER LIKE CONCAT(CONCAT('%', #{pd.USERNAME}),'%')
            or
            u.NAME LIKE CONCAT(CONCAT('%', #{pd.USERNAME}),'%')
            or
            u.PHONE LIKE CONCAT(CONCAT('%', #{pd.USERNAME}),'%')
            )
        </if>
        <if test="pd.ROLE_ID != null and pd.ROLE_ID != ''"><!-- 角色检索 -->
            and u.ROLE_ID=#{pd.ROLE_ID}
        </if>
        <if test="pd.lastLoginStart!=null and pd.lastLoginStart!=''"><!-- 登录时间检索 -->
            and u.LAST_LOGIN &gt;= #{pd.lastLoginStart}
        </if>
        <if test="pd.lastLoginEnd!=null and pd.lastLoginEnd!=''"><!-- 登录时间检索 -->
            and u.LAST_LOGIN &lt;= #{pd.lastLoginEnd}
        </if>
        order by u.LAST_LOGIN desc
    </select>

    <!-- 新增用户 -->
    <insert id="saveU" parameterType="com.wp.util.PageData" flushCache="false">
        insert into SYS_USER (
        USER_ID,
        USERNAME,
        PASSWORD,
        NAME,
        RIGHTS,
        ROLE_ID,
        LAST_LOGIN,
        IP,
        STATUS,
        BZ,
        SKIN,
        EMAIL,
        NUMBER,
        PHONE,
        workshop,
        factory_id
        ) values (
        #{USER_ID},
        #{USERNAME},
        #{PASSWORD},
        #{NAME},
        #{RIGHTS},
        #{ROLE_ID},
        #{LAST_LOGIN},
        #{IP},
        #{STATUS},
        #{BZ},
        #{SKIN},
        #{EMAIL},
        #{NUMBER},
        #{PHONE},
        #{workshop},
        #{factory_id}
        )
    </insert>


    <update id="editU" parameterType="pd" flushCache="false">
        update  SYS_USER
        set USERNAME				= #{USERNAME},
        NAME 					= #{NAME},
        ROLE_ID 				= #{ROLE_ID},
        BZ						= #{BZ},
        EMAIL					= #{EMAIL},
        NUMBER					= #{NUMBER},
        PHONE					= #{PHONE},
        workshop                = #{workshop}
        <if test="PASSWORD != null and PASSWORD != ''">
            ,PASSWORD				= #{PASSWORD}
        </if>
        where
        USER_ID = #{USER_ID}
    </update>



</mapper>